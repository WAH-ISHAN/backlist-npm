// Auto-generated by create-backlist v4.0 on <%= new Date().toISOString() %>
import mongoose from 'mongoose';
import dotenv from 'dotenv';
import { faker } from '@faker-js/faker';
import chalk from 'chalk'; // For colorful console logs

// Load env vars
dotenv.config();

// We assume a User model exists for seeding.
// The path is relative to the generated 'backend' project root.
import User from '../src/models/User.model';

// --- Connect to DB ---
const connectDB = async () => {
  try {
    const MONGO_URI = process.env.MONGO_URI || 'mongodb://127.0.0.1:27017/<%= projectName %>';
    if (!MONGO_URI) {
        throw new Error('MONGO_URI is not defined in your .env file');
    }
    await mongoose.connect(MONGO_URI);
    console.log(chalk.green('MongoDB Connected for Seeder...'));
  } catch (err) {
    console.error(chalk.red(`Seeder DB Connection Error: ${err.message}`));
    process.exit(1);
  }
};

// --- Import Data ---
const importData = async () => {
  try {
    // Clear existing data
    await User.deleteMany();

    const sampleUsers = [];
    const userCount = 10; // Number of sample users to create

    for (let i = 0; i < userCount; i++) {
      sampleUsers.push({
        name: faker.person.fullName(),
        email: faker.internet.email().toLowerCase(),
        password: 'password123', // All sample users will have the same password for easy testing
      });
    }

    await User.insertMany(sampleUsers);

    console.log(chalk.green.bold('âœ… Data Imported Successfully!'));
    process.exit();
  } catch (error) {
    console.error(chalk.red(`Error with data import: ${error.message}`));
    process.exit(1);
  }
};

// --- Destroy Data ---
const destroyData = async () => {
  try {
    await User.deleteMany();
    // If you have other models, you can add them here for destruction
    // e.g., await Product.deleteMany();

    console.log(chalk.red.bold('ðŸ”¥ Data Destroyed Successfully!'));
    process.exit();
  } catch (error) {
    console.error(chalk.red(`Error with data destruction: ${error.message}`));
    process.exit(1);
  }
};

// --- CLI Logic to run the seeder ---
const runSeeder = async () => {
  await connectDB();

  // process.argv[2] will be '-d' if the script is run with `npm run destroy`
  if (process.argv[2] === '-d') {
    await destroyData();
  } else {
    await importData();
  }
};

runSeeder();