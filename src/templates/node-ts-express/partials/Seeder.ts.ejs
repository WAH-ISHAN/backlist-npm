// Auto-generated by create-backlist v5.1 on <%= new Date().toISOString() %>
import mongoose from 'mongoose';
import dotenv from 'dotenv';
import { faker } from '@faker-js/faker';
import chalk from 'chalk';

dotenv.config();

import User from '../src/models/User.model';

function getErrorMessage(err: unknown) {
  if (err instanceof Error) return err.message;
  return String(err);
}

async function connectDB() {
  const MONGO_URI = process.env.MONGO_URI || 'mongodb://127.0.0.1:27017/<%= projectName %>';
  if (!MONGO_URI) throw new Error('MONGO_URI is not defined');

  await mongoose.connect(MONGO_URI);
  console.log(chalk.green('MongoDB Connected for Seeder...'));
}

async function importData() {
  // Clear existing data
  await User.deleteMany({});

  const sampleUsers = Array.from({ length: 10 }).map(() => ({
    name: faker.person.fullName(),
    email: faker.internet.email().toLowerCase(),
    password: 'password123',
  }));

  await User.insertMany(sampleUsers);

  console.log(chalk.green.bold('Data Imported Successfully!'));
}

async function destroyData() {
  await User.deleteMany({});
  console.log(chalk.red.bold('Data Destroyed Successfully!'));
}

async function run() {
  try {
    await connectDB();

    if (process.argv.includes('-d')) {
      await destroyData();
    } else {
      await importData();
    }
  } catch (err) {
    console.error(chalk.red(`Seeder error: ${getErrorMessage(err)}`));
    process.exitCode = 1;
  } finally {
    try {
      await mongoose.disconnect();
    } catch {}
  }
}

run();