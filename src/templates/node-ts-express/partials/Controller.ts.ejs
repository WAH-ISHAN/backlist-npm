// Auto-generated by create-backlist on <%= new Date().toISOString() %>
import { Request, Response } from 'express';

/**
 * Controller: <%= controllerName %>
 * Generated from frontend AST scan.
 */

<%
function safeAction(name, fallback) {
  if (!name) return fallback;
  return String(name).replace(/[^a-zA-Z0-9_]/g, '');
}

function hasBody(method) {
  const m = String(method || 'GET').toUpperCase();
  return ['POST', 'PUT', 'PATCH'].includes(m);
}
%>

<% if (!Array.isArray(endpoints) || endpoints.length === 0) { %>
export async function health(_req: Request, res: Response) {
  return res.status(200).json({ ok: true });
}
<% } %>

<% (endpoints || []).forEach((ep, i) => { 
  const method = String(ep.method || 'GET').toUpperCase();
  const actionName = safeAction(ep.actionName, `handler${i}`);
  const route = ep.route || ep.path || '';
-%>
/**
 * <%= method %> <%= route %>
 */
export async function <%= actionName %>(req: Request, res: Response) {
  try {
<% if (hasBody(method)) { -%>
    // Body schema (inferred):
    // <%- JSON.stringify(ep.schemaFields || ep.requestBody?.fields || {}, null, 2).split('\n').map(l => '// ' + l).join('\n') %>
    const payload = req.body;
    return res.status(<%= method === 'POST' ? 201 : 200 %>).json({ message: 'TODO: implement', payload });
<% } else { -%>
    return res.status(200).json({ message: 'TODO: implement', params: req.params, query: req.query });
<% } -%>
  } catch (error) {
    return res.status(500).json({ message: 'Internal Server Error', error });
  }
}

<% }) -%>