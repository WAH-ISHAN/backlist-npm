// Auto-generated by create-backlist v5.1
import request from 'supertest';
import express from 'express';

import apiRoutes from '../routes'; 
<% if (addAuth) { -%>
import authRoutes from '../routes/Auth.routes';
<% } -%>

const app = express();
app.use(express.json());

<% if (addAuth) { -%>
app.use('/api/auth', authRoutes);
<% } -%>
app.use('/api', apiRoutes);

describe('API Endpoints (Generated)', () => {
  it('sanity check', () => {
    expect(1 + 1).toBe(2);
  });

  <% endpoints
      .filter(ep => ep && ep.route && ep.method)
      .forEach(ep => { 
        const method = ep.method.toLowerCase();
        const url = (ep.route.startsWith('/api/') ? ep.route.replace(/^\/api/, '') : ep.route)
          .replace(/:\w+/g, '1'); // replace path params with dummy value
  -%>
  it('<%= ep.method %> <%= url %> should respond', async () => {
    const res = await request(app).<%= method %>('<%= '/api' + url %>')<% if (['post','put','patch'].includes(method) && ep.schemaFields) { %>
      .send(<%- JSON.stringify(Object.fromEntries(Object.entries(ep.schemaFields).map(([k,t]) => [k, t === 'Number' ? 1 : (t === 'Boolean' ? true : 'test') ]))) %>)<% } %>;
    // We only assert "not 404" because generated handlers may be TODO stubs,
    // and auth/validation may affect exact status codes.
    expect(res.statusCode).not.toBe(404);
  });
  <% }) -%>
});