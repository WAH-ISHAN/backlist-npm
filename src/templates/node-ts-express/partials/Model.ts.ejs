// Auto-generated by create-backlist on <%= new Date().toISOString() %>
import mongoose, { Schema, Document } from 'mongoose';

export interface I<%= modelName %> extends Document {
<% Object.keys(schema).forEach(key => {
    const t = String(schema[key] || 'String');
    let tsType = 'string';
    if (t === 'Number') tsType = 'number';
    if (t === 'Boolean') tsType = 'boolean';
    if (t === 'Date') tsType = 'Date';
%>
  <%= key %>: <%= tsType %>;
<% }); %>
}

const <%= modelName %>Schema = new Schema<I<%= modelName %>>(
  {
<% Object.keys(schema).forEach(key => {
    const t = String(schema[key] || 'String');
    const lower = String(key).toLowerCase();
    const isEmail = lower === 'email' || lower.includes('email');
    const isPassword = lower === 'password';
    const isNameLike = ['name','title'].some(x => lower === x || lower.includes(x));
%>
    <%= key %>: {
      type: <%= t %>,
      <% if (isEmail) { -%>
      required: true,
      unique: true,
      trim: true,
      lowercase: true,
      <% } else if (isPassword) { -%>
      required: true,
      select: false,
      <% } else if (isNameLike) { -%>
      required: true,
      trim: true,
      <% } else { -%>
      // TODO: add required/unique/default/enum rules if needed
      <% } -%>
    },
<% }); %>
  },
  { timestamps: true }
);

// Extra indexes (optional)
<% if (Object.keys(schema).some(k => String(k).toLowerCase().includes('email'))) { -%>
<%= modelName %>Schema.index({ email: 1 }, { unique: true });
<% } -%>

export default mongoose.model<I<%= modelName %>>('<%= modelName %>', <%= modelName %>Schema);